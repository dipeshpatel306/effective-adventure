/************************************************************************************************************************************
 *	neosmart STREAM - admin area
 *
 *	@copyright:			neosmart GmbH
 *	@licence:			https://neosmart-stream.de/legal/license-agreement/
 *	@documentation:		https://neosmart-stream.de/docs/
 *	@version:			1.0.0
 *	
 ************************************************************************************************************************************/
(function(a){a.fn.neosmartStreamAdmin=function(p){var c=a.extend({},a.fn.neosmartStreamAdmin.defaults,p);var i=this;n();function n(){if(a(".nss-admin-add-channel").length){a(".nss-admin-remove").unbind("click").click(m);a(".nss-admin-add-channel").click(e);a("#save-channels").click(function(){k(false)});a(".atc-button").click(function(q){var o=a(q.currentTarget);b(o.attr("data-id"))});a('input[name="access_token_expires"]').on("change focus keyup blur",f).trigger("keyup");a("#new-channel-type").change(d);j()}}function j(){a(".nss-admin-channel").each(function(s,u){var r=a(u);var t=r.attr("data-channel");var v,o,q;r.find(".nss-admin-test").click(function(w){r.find(".channel-status").html("testing ...").addClass("loading");switch(t){case"facebook":v=r.find('input[name="id"]').val();q=r.find('input[name="access_token"]').val();h("facebook",r,v,o,q);break;case"twitter":v=r.find('input[name="id"]').val();h("twitter",r,v,o,q);break;case"nss":o=r.find('input[name="url"]').val();h("nss",r,v,o,q);break}})})}function h(s,r,t,o,q){a.ajax({url:"ajax.test.channel.php",data:"channel="+s+"&id="+t+"&url="+o+"&token="+q,type:"post",complete:function(u){r.find(".channel-status").html(u.responseText).removeClass("loading")}})}function d(){var o=a("#new-channel-type").val();a(".new-channel-container").hide();a("#add-channel-error").hide();switch(o){case"facebook":a("#nss-admin-add-channel-facebook").fadeIn();break;case"twitter":a("#nss-admin-add-channel-twitter").fadeIn();break;case"nss":a("#nss-admin-add-channel-nss").fadeIn();break}}function f(s){var r=a(s.currentTarget);var t=new Date();var o=new Array("January","February","March","April","May","June","July","August","September","October","November","December");t.setTime(parseInt(r.val())*1000);var q=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+" on "+t.getDate()+" "+o[t.getMonth()]+"  "+t.getFullYear();if(isNaN(t.getDate())){q=""}r.parent().find(".expires_in_real_time").text(q)}function k(r){var q="";var o=r===true?".nss-admin-channel":'.nss-admin-channel:not([data-channel="new"])';a(o).each(function(y,v){var B=a(v);var A=B.attr("data-channel");var t,z,w,s,u,x;if(A=="new"){A=a("#new-channel-type").val();B=a("#nss-admin-add-channel-"+A)}switch(A){case"facebook":t=B.find('input[name="id"]').val();z=B.find('input[name="access_token"]').val();w=parseInt(B.find('input[name="limit"]').val());if(isNaN(w)){w=0}B.find('input[name="limit"]').val(w);x=B.find('[name="show_all"]').val();u=B.find('[name="access_token_expires"]').val();if(!u){u=0}q+="$nss->addChannel('facebook','"+t+"','"+z+"',"+w+",'"+x+"',"+u+");\n";break;case"twitter":t=B.find('input[name="id"]').val();w=parseInt(B.find('input[name="limit"]').val());if(isNaN(w)||w<1){w=1}q+="$nss->addChannel('twitter','"+t+"',"+w+");\n";break;case"nss":s=B.find('input[name="url"]').val();q+="$nss->addChannel('nss','"+s+"');\n";break}});a.ajax({url:"index.php",data:"action=update_channels&channels="+q,type:"post",complete:function(s){document.location.reload(true)}})}function m(q){var o=a(q.currentTarget).parent().parent();o.fadeOut(500,function(){o.remove();k(false)})}function l(q,o){a.ajax({url:"https://graph.facebook.com/"+q+"/feed/?access_token="+o,complete:function(r){}})}function e(){var t=a("#new-channel-type").val();var r=a("#add-channel-error").hide();var q=new Date();var s=t+"_"+Math.round(Math.random()*99999999)+"_"+q.getTime();var o="";var u;switch(t){case"facebook":u=a("#nss-admin-add-channel-facebook");if(u.find('input[name="id"]').val()==""){o+="<p>Enter Your Facebook ID</p>"}if(u.find('input[name="access_token"]').val()==""){o+="<p>Enter a valid Access Token</p>"}break;case"twitter":u=a("#nss-admin-add-channel-twitter");if(u.find('input[name="id"]').val()==""){o+="<p>Enter Your Twitter ID</p>"}break;case"nss":u=a("#nss-admin-add-channel-nss");if(u.find('input[name="url"]').val()==""){o+="<p>Enter Your NSS URL</p>"}break}if(o!=""){r.html('<div class="row">'+o+"</div>").fadeIn();return false}k(true)}function g(o){o?a(".not-saved").fadeIn(500):a(".not-saved").fadeOut(500)}function b(s){var q=window.open("atc.php","ATC","width=1000,height=500,left=100,top=100");var r=a(".channel-id-"+s);q.focus();var o=setInterval(function(){try{var t=q.$.find("#atc-access-token");var v=a(t);if(v.length){var w=q.$.find("#atc-expires");var u=a(w);r.find('input[name="access_token"]').val(v.text());r.find('input[name="access_token_expires"]').val(u.text()).trigger("change").parent().parent().fadeIn();q.close();clearInterval(o);g(true)}}catch(w){}},1000)}return i};a.fn.neosmartStreamAdmin.defaults={}})(jQuery);